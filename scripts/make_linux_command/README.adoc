= make_linux_command
:toc: macro
:toc-title: Table des matières
:toclevels: 3
:source-highlighter: pygments
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
toc::[]

image:https://img.shields.io/badge/Python-...-blue[Python .., link="https://www.python.org/"]
image:https://img.shields.io/badge/license-MIT-green[MIT License, link="https://opensource.org/licenses/MIT"]
image:https://img.shields.io/badge/status-stable-brightgreen[Stable]

`make_linux_command` est un outil en ligne de commande qui transforme un module Python en une commande Linux exécutable.
Il crée un environnement virtuel dédié, installe les dépendances nécessaires et génère un wrapper Bash pour rendre votre module accessible directement depuis le terminal.

== Fonctionnalités
- Création d'un environnement virtuel dédié à votre commande.
- Installation du module en mode éditable (`pip install -e`).
- Installation des dépendances depuis un fichier `requirements.txt`.
- Création d'un wrapper Bash pour exécuter votre commande.
- Support de l'installation locale (sans droits root) ou globale.
- Gestion des erreurs et messages clairs.

== Prérequis
- Python ..ou supérieur.
- Accès à `pip` et `venv`.
- Droits d'administration (`sudo`) pour une installation globale.

== TL;DR

Se placer à la racine du dépôt et taper la commande suivante pour transformer le package make_linux_command en commande `mkcmd` :

[source, bash]
make-linux-command make_linux_command/main.py mkcmd --local

== Installation

== Utilisation

=== Commande de base
[source,bash]
----
make-linux-command <chemin_vers_module> <nom_commande>
----

=== Options disponibles
|===
| Option | Description

| `--local`
| Installe la commande et l'environnement virtuel localement (`~/.local/venv`).

| `--skip-deps`
| Ne pas installer les dépendances depuis `requirements.txt`.

| `--venv-dir`
| Spécifie le dossier pour l'environnement virtuel (par défaut : `/opt` pour une installation globale, `~/.local/venv` pour une installation locale).

| `--force`
| Remplace les fichiers existants (lien symbolique et wrapper).
|===

=== Exemple
[source,bash]
----
make-linux-command ~/mon_projet mycommand --local
----

== Structure du projet

Le module à transformer en commande doit contenir au minimum un fichier `cli.py` à sa racine.

Exemple de structure :
----
mon_projet/
├── cli.py          <.
├── requirements.txt
└── ...
----
<. Le fichier `cli.py` doit contenir un point d'entrée pour votre commande (par exemple, une fonction décorée avec `@click.command()`).

=== Exemple de fichier `cli.py`

[source,python]
----
#!/usr/bin/env python3
import click

@click.command()
def main():
    """Exemple de commande."""
    click.echo("Bonjour depuis ma commande personnalisée !")

if __name__ == "__main__":
    main()
----

== Fonctionnement interne

. **Vérification de la structure** : Le script vérifie que le module contient bien un fichier `cli.py`.
. **Création de l'environnement virtuel** : Un environnement virtuel est créé dans `/opt/<nom_commande>/env` (ou `~/.local/venv/<nom_commande>/env` en mode local).
. **Installation des dépendances** : Les dépendances listées dan
